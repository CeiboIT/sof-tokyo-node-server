///<reference path='../../../typings/tsd.d.ts' />
'use strict';
var mysql = require("mysql");
var q = require("q");
var request = require("request");
var ConnectionService = (function () {
    function ConnectionService() {
        this.dbConfig = {
            host: 'gator2009.hostgator.com',
            user: 'tdnb1207_sof',
            password: 'pkc~^_9WZ(us',
            //database: 'tdnb1207_sof', // production
            database: 'tdnb1207_sof_develop',
            debug: false,
            insecureAuth: true
        };
    }
    ConnectionService.prototype.query = function (params) {
        var _queryPromise = q.defer();
        request('http://sof.tokyo/api/' + params, function (error, response, body) {
            if (!error && response.statusCode == 200) {
                _queryPromise.resolve(JSON.parse(body)); // Show the HTML for the Google homepage.
            }
            else {
                _queryPromise.resolve(JSON.parse(body));
            }
        });
        return _queryPromise.promise;
    };
    ConnectionService.prototype.query_db = function (params) {
        var defer = q.defer();
        var _rows;
        var _connection = mysql.createConnection(this.dbConfig);
        _connection.query(params, function (err, rows) {
            _connection.end();
            if (err) {
                defer.reject(err);
                throw err;
            }
            ;
            defer.resolve(rows);
        });
        return defer.promise;
    };
    return ConnectionService;
})();
exports.ConnectionService = ConnectionService;
exports.service = new ConnectionService();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvY29ubmVjdGlvbi9jb25uZWN0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOlsiQ29ubmVjdGlvblNlcnZpY2UiLCJDb25uZWN0aW9uU2VydmljZS5jb25zdHJ1Y3RvciIsIkNvbm5lY3Rpb25TZXJ2aWNlLnF1ZXJ5IiwiQ29ubmVjdGlvblNlcnZpY2UucXVlcnlfZGIiXSwibWFwcGluZ3MiOiJBQUFBLEFBQ0EsaURBRGlEO0FBQ2pELFlBQVksQ0FBQztBQUViLElBQU8sS0FBSyxXQUFXLE9BQU8sQ0FBQyxDQUFDO0FBQ2hDLElBQU8sQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0FBQ3hCLElBQU8sT0FBTyxXQUFXLFNBQVMsQ0FBQyxDQUFDO0FBT3BDLElBQWEsaUJBQWlCO0lBSTFCQSxTQUpTQSxpQkFBaUJBO1FBS3RCQyxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQTtZQUNaQSxJQUFJQSxFQUFFQSx5QkFBeUJBO1lBQy9CQSxJQUFJQSxFQUFFQSxjQUFjQTtZQUNwQkEsUUFBUUEsRUFBRUEsY0FBY0E7WUFDeEJBLEFBQ0FBLHlDQUR5Q0E7WUFDekNBLFFBQVFBLEVBQUVBLHNCQUFzQkE7WUFDaENBLEtBQUtBLEVBQUVBLEtBQUtBO1lBQ1pBLFlBQVlBLEVBQUVBLElBQUlBO1NBQ3JCQSxDQUFBQTtJQUNMQSxDQUFDQTtJQUVERCxpQ0FBS0EsR0FBTEEsVUFBTUEsTUFBTUE7UUFDUkUsSUFBSUEsYUFBYUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDOUJBLE9BQU9BLENBQUNBLHVCQUF1QkEsR0FBR0EsTUFBTUEsRUFBRUEsVUFBU0EsS0FBS0EsRUFBRUEsUUFBUUEsRUFBRUEsSUFBSUE7WUFDcEUsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLFVBQVUsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN2QyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBQyx5Q0FBeUM7WUFDckYsQ0FBQyxHQUQwQztZQUN6QyxJQUFJLENBQUMsQ0FBQztnQkFDSixhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtZQUMzQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDQSxDQUFBQTtRQUNGQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQTtJQUNqQ0EsQ0FBQ0E7SUFFREYsb0NBQVFBLEdBQVJBLFVBQVNBLE1BQU1BO1FBQ1hHLElBQUlBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBQ3RCQSxJQUFJQSxLQUFLQSxDQUFDQTtRQUNWQSxJQUFJQSxXQUFXQSxHQUFHQSxLQUFLQSxDQUFDQSxnQkFBZ0JBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1FBQ3hEQSxXQUFXQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxFQUFFQSxVQUFDQSxHQUFHQSxFQUFFQSxJQUFJQTtZQUNoQ0EsV0FBV0EsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7WUFDbEJBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO2dCQUNOQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtnQkFBQ0EsTUFBTUEsR0FBR0EsQ0FBQUE7WUFDaENBLENBQUNBO1lBQUFBLENBQUNBO1lBQ0ZBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ3hCQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUNGQSxNQUFNQSxDQUFDQSxLQUFLQSxDQUFDQSxPQUFPQSxDQUFDQTtJQUN6QkEsQ0FBQ0E7SUFFTEgsd0JBQUNBO0FBQURBLENBMUNBLEFBMENDQSxJQUFBO0FBMUNZLHlCQUFpQixHQUFqQixpQkEwQ1osQ0FBQTtBQUVVLGVBQU8sR0FBRyxJQUFJLGlCQUFpQixFQUFFLENBQUMiLCJmaWxlIjoibW9kdWxlcy9jb25uZWN0aW9uL2Nvbm5lY3Rpb24uc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD0nLi4vLi4vLi4vdHlwaW5ncy90c2QuZC50cycgLz5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IG15c3FsID0gcmVxdWlyZShcIm15c3FsXCIpO1xuaW1wb3J0IHEgPSByZXF1aXJlKFwicVwiKTtcbmltcG9ydCByZXF1ZXN0ID0gcmVxdWlyZShcInJlcXVlc3RcIik7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbm5lY3Rpb25TZXJ2aWNlIHtcbiAgICBxdWVyeShwYXJhbXMpOiBxLklQcm9taXNlPHt9PlxuICAgIHF1ZXJ5X2RiKHBhcmFtcyk6IHEuSVByb21pc2U8e30+XG59XG5cbmV4cG9ydCBjbGFzcyBDb25uZWN0aW9uU2VydmljZSBpbXBsZW1lbnRzIElDb25uZWN0aW9uU2VydmljZSB7XG4gICAgcHJpdmF0ZSBjb25uZWN0aW9uU3RyZWFtO1xuICAgIHByaXZhdGUgZGJDb25maWc7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5kYkNvbmZpZyA9IHtcbiAgICAgICAgICAgIGhvc3Q6ICdnYXRvcjIwMDkuaG9zdGdhdG9yLmNvbScsXG4gICAgICAgICAgICB1c2VyOiAndGRuYjEyMDdfc29mJyxcbiAgICAgICAgICAgIHBhc3N3b3JkOiAncGtjfl5fOVdaKHVzJyxcbiAgICAgICAgICAgIC8vZGF0YWJhc2U6ICd0ZG5iMTIwN19zb2YnLCAvLyBwcm9kdWN0aW9uXG4gICAgICAgICAgICBkYXRhYmFzZTogJ3RkbmIxMjA3X3NvZl9kZXZlbG9wJywgLy8gZGV2ZWxvcFxuICAgICAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAgICAgaW5zZWN1cmVBdXRoOiB0cnVlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBxdWVyeShwYXJhbXMpOiBxLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHZhciBfcXVlcnlQcm9taXNlID0gcS5kZWZlcigpO1xuICAgICAgICByZXF1ZXN0KCdodHRwOi8vc29mLnRva3lvL2FwaS8nICsgcGFyYW1zLCBmdW5jdGlvbihlcnJvciwgcmVzcG9uc2UsIGJvZHkpIHtcbiAgICAgICAgICAgIGlmICghZXJyb3IgJiYgcmVzcG9uc2Uuc3RhdHVzQ29kZSA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICBfcXVlcnlQcm9taXNlLnJlc29sdmUoSlNPTi5wYXJzZShib2R5KSkgLy8gU2hvdyB0aGUgSFRNTCBmb3IgdGhlIEdvb2dsZSBob21lcGFnZS5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgX3F1ZXJ5UHJvbWlzZS5yZXNvbHZlKEpTT04ucGFyc2UoYm9keSkpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBfcXVlcnlQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgcXVlcnlfZGIocGFyYW1zKTogcS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgZGVmZXIgPSBxLmRlZmVyKCk7XG4gICAgICAgIHZhciBfcm93cztcbiAgICAgICAgdmFyIF9jb25uZWN0aW9uID0gbXlzcWwuY3JlYXRlQ29ubmVjdGlvbih0aGlzLmRiQ29uZmlnKTtcbiAgICAgICAgX2Nvbm5lY3Rpb24ucXVlcnkocGFyYW1zLCAoZXJyLCByb3dzKSA9PiB7XG4gICAgICAgICAgICBfY29ubmVjdGlvbi5lbmQoKTtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QoZXJyKTsgdGhyb3cgZXJyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyb3dzKTtcbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XG4gICAgfVxuXG59XG5cbmV4cG9ydCB2YXIgc2VydmljZSA9IG5ldyBDb25uZWN0aW9uU2VydmljZSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9