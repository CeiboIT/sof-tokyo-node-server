/// <reference path="../../../typings/tsd.d.ts" />
/// <reference path="../connection/connection.service.ts" />
var Q = require("q");
var connection = require('../connection/connection.service');
var MessagesService = (function () {
    function MessagesService() {
        this.db = connection.service;
    }
    MessagesService.prototype.createMessage = function (sender_id, receiver_id, subject, message) {
        var _this = this;
        var _promise = Q.defer();
        var thread_id = Math.floor((Math.random() * 100000) + 1);
        var now = new Date();
        // insert record sender
        this.db.query_db("INSERT INTO wp2_bp_messages_recipients (id, user_id, thread_id, unread_count, sender_only, is_deleted) " + "VALUES (NULL," + sender_id + "," + thread_id + ",0,0,0)").then(function () {
            // insert record receiver
            _this.db.query_db("INSERT INTO wp2_bp_messages_recipients (id, user_id, thread_id, unread_count, sender_only, is_deleted) " + "VALUES (NULL," + receiver_id + "," + thread_id + ",1,0,0)").then(function () {
                // insert message
                _this.db.query_db("INSERT INTO wp2_bp_messages_messages (id, thread_id, sender_id, subject, message, date_sent) " + "VALUES (NULL," + thread_id + "," + sender_id + ",'" + subject + "','" + message + "','" + now.toISOString() + "')").then(function () {
                    var response = {
                        status: 'Message created OK',
                        thread_id: thread_id,
                        sender_id: sender_id,
                        receiver_id: receiver_id,
                        subject: subject,
                        message: message,
                        date_sent: now.toISOString()
                    };
                    _promise.resolve(response);
                });
            });
        });
        return _promise.promise;
    };
    MessagesService.prototype.responseMessage = function (thread_id, sender_id, receiver_id, subject, message) {
        var _this = this;
        var _promise = Q.defer();
        var resSubject = 'Re: ' + subject;
        var now = new Date();
        // update record sender
        this.db.query_db("UPDATE wp2_bp_messages_recipients SET unread_count = 0 " + "WHERE user_id = " + sender_id + " AND thread_id = " + thread_id).then(function () {
            // update record receiver
            _this.db.query_db("UPDATE wp2_bp_messages_recipients SET unread_count = unread_count+1 WHERE " + " user_id = " + receiver_id + " AND thread_id = " + thread_id).then(function () {
                // insert message
                _this.db.query_db("INSERT INTO wp2_bp_messages_messages (id, thread_id, sender_id, subject, message, date_sent) " + "VALUES (NULL," + thread_id + "," + sender_id + ",'" + resSubject + "','" + message + "','" + now.toISOString() + "')").then(function () {
                    var response = {
                        status: 'Message response OK',
                        thread_id: thread_id,
                        sender_id: sender_id,
                        receiver_id: receiver_id,
                        subject: subject,
                        message: message,
                        date_sent: now.toISOString()
                    };
                    _promise.resolve(response);
                });
            });
        });
        return _promise.promise;
    };
    return MessagesService;
})();
exports.MessagesService = MessagesService;
;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvbWVzc2FnZXMvbWVzc2FnZXMuc2VydmljZS50cyJdLCJuYW1lcyI6WyJNZXNzYWdlc1NlcnZpY2UiLCJNZXNzYWdlc1NlcnZpY2UuY29uc3RydWN0b3IiLCJNZXNzYWdlc1NlcnZpY2UuY3JlYXRlTWVzc2FnZSIsIk1lc3NhZ2VzU2VydmljZS5yZXNwb25zZU1lc3NhZ2UiXSwibWFwcGluZ3MiOiJBQUFBLGtEQUFrRDtBQUNsRCw0REFBNEQ7QUFFNUQsSUFBTyxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7QUFDeEIsSUFBTyxVQUFVLFdBQVcsa0NBQWtDLENBQUMsQ0FBQTtBQVcvRCxJQUFhLGVBQWU7SUFBNUJBLFNBQWFBLGVBQWVBO1FBQ2hCQyxPQUFFQSxHQUFHQSxVQUFVQSxDQUFDQSxPQUFPQSxDQUFDQTtJQWdGcENBLENBQUNBO0lBOUVHRCx1Q0FBYUEsR0FBYkEsVUFBY0EsU0FBU0EsRUFBRUEsV0FBV0EsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0E7UUFBdERFLGlCQWtDQ0E7UUFqQ0dBLElBQUlBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBQ3pCQSxJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUN6REEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDckJBLEFBQ0FBLHVCQUR1QkE7UUFDdkJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLHlHQUF5R0EsR0FDdEdBLGVBQWVBLEdBQUdBLFNBQVNBLEdBQUdBLEdBQUdBLEdBQUdBLFNBQVNBLEdBQUdBLFNBQVNBLENBQUNBLENBQ3pFQSxJQUFJQSxDQUFDQTtZQUVGQSxBQUNBQSx5QkFEeUJBO1lBQ3pCQSxLQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSx5R0FBeUdBLEdBQ3RHQSxlQUFlQSxHQUFHQSxXQUFXQSxHQUFHQSxHQUFHQSxHQUFHQSxTQUFTQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUMzRUEsSUFBSUEsQ0FBQ0E7Z0JBRUZBLEFBQ0FBLGlCQURpQkE7Z0JBQ2pCQSxLQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSwrRkFBK0ZBLEdBQzVGQSxlQUFlQSxHQUFHQSxTQUFTQSxHQUFHQSxHQUFHQSxHQUFHQSxTQUFTQSxHQUFHQSxJQUFJQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUNuSUEsSUFBSUEsQ0FBQ0E7b0JBQ0ZBLElBQUlBLFFBQVFBLEdBQUdBO3dCQUNYQSxNQUFNQSxFQUFFQSxvQkFBb0JBO3dCQUM1QkEsU0FBU0EsRUFBRUEsU0FBU0E7d0JBQ3BCQSxTQUFTQSxFQUFFQSxTQUFTQTt3QkFDcEJBLFdBQVdBLEVBQUVBLFdBQVdBO3dCQUN4QkEsT0FBT0EsRUFBRUEsT0FBT0E7d0JBQ2hCQSxPQUFPQSxFQUFFQSxPQUFPQTt3QkFDaEJBLFNBQVNBLEVBQUVBLEdBQUdBLENBQUNBLFdBQVdBLEVBQUVBO3FCQUMvQkEsQ0FBQ0E7b0JBQ0ZBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO2dCQUMvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFFVkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFFVkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFDTkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRURGLHlDQUFlQSxHQUFmQSxVQUFnQkEsU0FBU0EsRUFBRUEsU0FBU0EsRUFBRUEsV0FBV0EsRUFBRUEsT0FBT0EsRUFBRUEsT0FBT0E7UUFBbkVHLGlCQWtDQ0E7UUFqQ0dBLElBQUlBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBQ3pCQSxJQUFJQSxVQUFVQSxHQUFHQSxNQUFNQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUNsQ0EsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDckJBLEFBQ0FBLHVCQUR1QkE7UUFDdkJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLHlEQUF5REEsR0FDdERBLGtCQUFrQkEsR0FBR0EsU0FBU0EsR0FBR0EsbUJBQW1CQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUNoRkEsSUFBSUEsQ0FBQ0E7WUFFRkEsQUFDQUEseUJBRHlCQTtZQUN6QkEsS0FBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsNEVBQTRFQSxHQUM3RUEsYUFBYUEsR0FBR0EsV0FBV0EsR0FBR0EsbUJBQW1CQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUN6RUEsSUFBSUEsQ0FBQ0E7Z0JBRUZBLEFBQ0FBLGlCQURpQkE7Z0JBQ2pCQSxLQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSwrRkFBK0ZBLEdBQzVGQSxlQUFlQSxHQUFHQSxTQUFTQSxHQUFHQSxHQUFHQSxHQUFHQSxTQUFTQSxHQUFHQSxJQUFJQSxHQUFHQSxVQUFVQSxHQUFHQSxLQUFLQSxHQUFHQSxPQUFPQSxHQUFHQSxLQUFLQSxHQUFHQSxHQUFHQSxDQUFDQSxXQUFXQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUN0SUEsSUFBSUEsQ0FBQ0E7b0JBQ0ZBLElBQUlBLFFBQVFBLEdBQUdBO3dCQUNYQSxNQUFNQSxFQUFFQSxxQkFBcUJBO3dCQUM3QkEsU0FBU0EsRUFBRUEsU0FBU0E7d0JBQ3BCQSxTQUFTQSxFQUFFQSxTQUFTQTt3QkFDcEJBLFdBQVdBLEVBQUVBLFdBQVdBO3dCQUN4QkEsT0FBT0EsRUFBRUEsT0FBT0E7d0JBQ2hCQSxPQUFPQSxFQUFFQSxPQUFPQTt3QkFDaEJBLFNBQVNBLEVBQUVBLEdBQUdBLENBQUNBLFdBQVdBLEVBQUVBO3FCQUMvQkEsQ0FBQ0E7b0JBQ0ZBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO2dCQUMvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7WUFFVkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFFVkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFDTkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBUUxILHNCQUFDQTtBQUFEQSxDQWpGQSxBQWlGQ0EsSUFBQTtBQWpGWSx1QkFBZSxHQUFmLGVBaUZaLENBQUE7QUFBQSxDQUFDIiwiZmlsZSI6Im1vZHVsZXMvbWVzc2FnZXMvbWVzc2FnZXMuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi90eXBpbmdzL3RzZC5kLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9jb25uZWN0aW9uL2Nvbm5lY3Rpb24uc2VydmljZS50c1wiIC8+XG5cbmltcG9ydCBRID0gcmVxdWlyZShcInFcIik7XG5pbXBvcnQgY29ubmVjdGlvbiA9IHJlcXVpcmUoJy4uL2Nvbm5lY3Rpb24vY29ubmVjdGlvbi5zZXJ2aWNlJylcblxuZXhwb3J0IGludGVyZmFjZSBJTWVzc2FnZXNTZXJ2aWNlIHtcbiAgICAvLyBHRVRcbiAgICAvLyBQT1NUXG4gICAgY3JlYXRlTWVzc2FnZShzZW5kZXJfaWQsIHJlY2VpdmVyX2lkLCBzdWJqZWN0LCBtZXNzYWdlKTogUS5JUHJvbWlzZTx7fT47XG4gICAgcmVzcG9uc2VNZXNzYWdlKHRocmVhZF9pZCwgc2VuZGVyX2lkLCByZWNlaXZlcl9pZCwgc3ViamVjdCwgbWVzc2FnZSk6IFEuSVByb21pc2U8e30+O1xuICAgIC8vIFBVVFxuICAgIC8vIERFTEVURVxufVxuXG5leHBvcnQgY2xhc3MgTWVzc2FnZXNTZXJ2aWNlIGltcGxlbWVudHMgSU1lc3NhZ2VzU2VydmljZSB7XG4gICAgcHJpdmF0ZSBkYiA9IGNvbm5lY3Rpb24uc2VydmljZTtcblxuICAgIGNyZWF0ZU1lc3NhZ2Uoc2VuZGVyX2lkLCByZWNlaXZlcl9pZCwgc3ViamVjdCwgbWVzc2FnZSk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB2YXIgdGhyZWFkX2lkID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDEwMDAwMCkgKyAxKTtcbiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIC8vIGluc2VydCByZWNvcmQgc2VuZGVyXG4gICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJJTlNFUlQgSU5UTyB3cDJfYnBfbWVzc2FnZXNfcmVjaXBpZW50cyAoaWQsIHVzZXJfaWQsIHRocmVhZF9pZCwgdW5yZWFkX2NvdW50LCBzZW5kZXJfb25seSwgaXNfZGVsZXRlZCkgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVkFMVUVTIChOVUxMLFwiICsgc2VuZGVyX2lkICsgXCIsXCIgKyB0aHJlYWRfaWQgKyBcIiwwLDAsMClcIilcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcblxuICAgICAgICAgICAgICAgIC8vIGluc2VydCByZWNvcmQgcmVjZWl2ZXJcbiAgICAgICAgICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiSU5TRVJUIElOVE8gd3AyX2JwX21lc3NhZ2VzX3JlY2lwaWVudHMgKGlkLCB1c2VyX2lkLCB0aHJlYWRfaWQsIHVucmVhZF9jb3VudCwgc2VuZGVyX29ubHksIGlzX2RlbGV0ZWQpIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVkFMVUVTIChOVUxMLFwiICsgcmVjZWl2ZXJfaWQgKyBcIixcIiArIHRocmVhZF9pZCArIFwiLDEsMCwwKVwiKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluc2VydCBtZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiSU5TRVJUIElOVE8gd3AyX2JwX21lc3NhZ2VzX21lc3NhZ2VzIChpZCwgdGhyZWFkX2lkLCBzZW5kZXJfaWQsIHN1YmplY3QsIG1lc3NhZ2UsIGRhdGVfc2VudCkgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlZBTFVFUyAoTlVMTCxcIiArIHRocmVhZF9pZCArIFwiLFwiICsgc2VuZGVyX2lkICsgXCIsJ1wiICsgc3ViamVjdCArIFwiJywnXCIgKyBtZXNzYWdlICsgXCInLCdcIiArIG5vdy50b0lTT1N0cmluZygpICsgXCInKVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnTWVzc2FnZSBjcmVhdGVkIE9LJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZF9pZDogdGhyZWFkX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyX2lkOiBzZW5kZXJfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlcl9pZDogcmVjZWl2ZXJfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiBzdWJqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVfc2VudDogbm93LnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3Byb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX3Byb21pc2UucHJvbWlzZTtcbiAgICB9XG5cbiAgICByZXNwb25zZU1lc3NhZ2UodGhyZWFkX2lkLCBzZW5kZXJfaWQsIHJlY2VpdmVyX2lkLCBzdWJqZWN0LCBtZXNzYWdlKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgX3Byb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHZhciByZXNTdWJqZWN0ID0gJ1JlOiAnICsgc3ViamVjdDtcbiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIC8vIHVwZGF0ZSByZWNvcmQgc2VuZGVyXG4gICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJVUERBVEUgd3AyX2JwX21lc3NhZ2VzX3JlY2lwaWVudHMgU0VUIHVucmVhZF9jb3VudCA9IDAgXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiV0hFUkUgdXNlcl9pZCA9IFwiICsgc2VuZGVyX2lkICsgXCIgQU5EIHRocmVhZF9pZCA9IFwiICsgdGhyZWFkX2lkKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIHJlY29yZCByZWNlaXZlclxuICAgICAgICAgICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJVUERBVEUgd3AyX2JwX21lc3NhZ2VzX3JlY2lwaWVudHMgU0VUIHVucmVhZF9jb3VudCA9IHVucmVhZF9jb3VudCsxIFdIRVJFIFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIgdXNlcl9pZCA9IFwiICsgcmVjZWl2ZXJfaWQgKyBcIiBBTkQgdGhyZWFkX2lkID0gXCIgKyB0aHJlYWRfaWQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5zZXJ0IG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJJTlNFUlQgSU5UTyB3cDJfYnBfbWVzc2FnZXNfbWVzc2FnZXMgKGlkLCB0aHJlYWRfaWQsIHNlbmRlcl9pZCwgc3ViamVjdCwgbWVzc2FnZSwgZGF0ZV9zZW50KSBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiVkFMVUVTIChOVUxMLFwiICsgdGhyZWFkX2lkICsgXCIsXCIgKyBzZW5kZXJfaWQgKyBcIiwnXCIgKyByZXNTdWJqZWN0ICsgXCInLCdcIiArIG1lc3NhZ2UgKyBcIicsJ1wiICsgbm93LnRvSVNPU3RyaW5nKCkgKyBcIicpXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdNZXNzYWdlIHJlc3BvbnNlIE9LJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocmVhZF9pZDogdGhyZWFkX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyX2lkOiBzZW5kZXJfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlcl9pZDogcmVjZWl2ZXJfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiBzdWJqZWN0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVfc2VudDogbm93LnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3Byb21pc2UucmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX3Byb21pc2UucHJvbWlzZTtcbiAgICB9XG4vKlxuICAgIHJlYWRNZXNzYWdlcyh1c2VySWQsIHRocmVhZElkKSB7XG4gICAgICAgIHZhciB1bnJlYWRfY291bnQgPSAwO1xuICAgIH1cbiovXG5cblxufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==