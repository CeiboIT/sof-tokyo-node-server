/// <reference path="../../../typings/tsd.d.ts" />
/// <reference path="../connection/connection.service.ts" />
var Q = require("q");
var connection = require('../connection/connection.service');
var MetadataService = (function () {
    function MetadataService() {
        this.db = connection.service;
    }
    MetadataService.prototype.getSubcategories0List = function () {
        var _listPromise = Q.defer();
        this.db.query_db("SELECT DISTINCT meta_value AS value FROM wp2_postmeta WHERE meta_key = 'sofbackend__sof_work_meta__category_0'").then(function (data) {
            _listPromise.resolve(data);
        });
        return _listPromise.promise;
    };
    MetadataService.prototype.getSubcategories1List = function () {
        var _listPromise = Q.defer();
        this.db.query_db("SELECT DISTINCT meta_value AS value FROM wp2_postmeta WHERE meta_key = 'sofbackend__sof_work_meta__category_1'").then(function (data) {
            _listPromise.resolve(data);
        });
        return _listPromise.promise;
    };
    MetadataService.prototype.getSchoolsList = function () {
        var _listPromise = Q.defer();
        this.db.query_db("SELECT DISTINCT value FROM wp2_bp_xprofile_data WHERE field_id=4").then(function (data) {
            _listPromise.resolve(data);
        });
        return _listPromise.promise;
    };
    MetadataService.prototype.getStylesList = function () {
        var _listPromise = Q.defer();
        this.db.query_db("SELECT DISTINCT meta_value AS value FROM wp2_postmeta WHERE meta_key = 'sofbackend__sof_work_meta__style'").then(function (data) {
            _listPromise.resolve(data);
        });
        return _listPromise.promise;
    };
    MetadataService.prototype.getSchoolByMemberId = function (memberId) {
        var _promise = Q.defer();
        this.db.query_db("SELECT value FROM wp2_bp_xprofile_data WHERE field_id=4 AND user_id=" + memberId).then(function (data) {
            _promise.resolve(data);
        });
        return _promise.promise;
    };
    MetadataService.prototype.getProductLikes = function (productId) {
        var _promise = Q.defer();
        this.db.query_db("SELECT meta_value AS value FROM wp2_postmeta WHERE meta_key='_item_likes' AND post_id=" + productId).then(function (data) {
            _promise.resolve(data);
        });
        return _promise.promise;
    };
    MetadataService.prototype.createProductLike = function (productId) {
        var _promise = Q.defer();
        this.db.query_db("UPDATE wp2_postmeta SET meta_value = meta_value + 1 WHERE meta_key='_item_likes' AND post_id=" + productId).then(function (data) {
            _promise.resolve(data);
        });
        return _promise.promise;
    };
    MetadataService.prototype.getProductUniqueVisits = function (productId) {
        var _promise = Q.defer();
        this.db.query_db("SELECT COUNT(DISTINCT meta_value) AS value FROM wp2_postmeta WHERE meta_key = 'visit' AND post_id=" + productId).then(function (data) {
            _promise.resolve(data);
        });
        return _promise.promise;
    };
    MetadataService.prototype.getProductTotalVisits = function (productId) {
        var _promise = Q.defer();
        this.db.query_db("SELECT COUNT(meta_value) AS value FROM wp2_postmeta WHERE meta_key = 'visit' AND post_id=" + productId).then(function (data) {
            _promise.resolve(data);
        });
        return _promise.promise;
    };
    return MetadataService;
})();
exports.MetadataService = MetadataService;
;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvbWV0YWRhdGEvbWV0YWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6WyJNZXRhZGF0YVNlcnZpY2UiLCJNZXRhZGF0YVNlcnZpY2UuY29uc3RydWN0b3IiLCJNZXRhZGF0YVNlcnZpY2UuZ2V0U3ViY2F0ZWdvcmllczBMaXN0IiwiTWV0YWRhdGFTZXJ2aWNlLmdldFN1YmNhdGVnb3JpZXMxTGlzdCIsIk1ldGFkYXRhU2VydmljZS5nZXRTY2hvb2xzTGlzdCIsIk1ldGFkYXRhU2VydmljZS5nZXRTdHlsZXNMaXN0IiwiTWV0YWRhdGFTZXJ2aWNlLmdldFNjaG9vbEJ5TWVtYmVySWQiLCJNZXRhZGF0YVNlcnZpY2UuZ2V0UHJvZHVjdExpa2VzIiwiTWV0YWRhdGFTZXJ2aWNlLmNyZWF0ZVByb2R1Y3RMaWtlIiwiTWV0YWRhdGFTZXJ2aWNlLmdldFByb2R1Y3RVbmlxdWVWaXNpdHMiLCJNZXRhZGF0YVNlcnZpY2UuZ2V0UHJvZHVjdFRvdGFsVmlzaXRzIl0sIm1hcHBpbmdzIjoiQUFBQSxrREFBa0Q7QUFDbEQsNERBQTREO0FBRTVELElBQU8sQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0FBQ3hCLElBQU8sVUFBVSxXQUFXLGtDQUFrQyxDQUFDLENBQUE7QUFrQi9ELElBQWEsZUFBZTtJQUE1QkEsU0FBYUEsZUFBZUE7UUFDaEJDLE9BQUVBLEdBQUdBLFVBQVVBLENBQUNBLE9BQU9BLENBQUNBO0lBbUZwQ0EsQ0FBQ0E7SUFqRkdELCtDQUFxQkEsR0FBckJBO1FBQ0lFLElBQUlBLFlBQVlBLEdBQUdBLENBQUNBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBQzdCQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxRQUFRQSxDQUFDQSxnSEFBZ0hBLENBQUNBLENBQzdIQSxJQUFJQSxDQUFDQSxVQUFDQSxJQUFJQTtZQUNQQSxZQUFZQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUMvQkEsQ0FBQ0EsQ0FBQ0EsQ0FBQUE7UUFD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Q0EsQ0FBQ0EsQ0FBQUE7UUFDTkEsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7SUFDNUJBLENBQUNBO0lBRURSLGdEQUFzQkEsR0FBdEJBLFVBQXVCQSxTQUFTQTtRQUM1QlMsSUFBSUEsUUFBUUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0E7UUFDekJBLElBQUlBLENBQUNBLEVBQUVBLENBQUNBLFFBQVFBLENBQUNBLG9HQUFvR0EsR0FBR0EsU0FBU0EsQ0FBQ0EsQ0FDN0hBLElBQUlBLENBQUNBLFVBQUNBLElBQUlBO1lBQ1BBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQzNCQSxDQUFDQSxDQUFDQSxDQUFBQTtRQUNOQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxPQUFPQSxDQUFDQTtJQUM1QkEsQ0FBQ0E7SUFFRFQsK0NBQXFCQSxHQUFyQkEsVUFBc0JBLFNBQVNBO1FBQzNCVSxJQUFJQSxRQUFRQSxHQUFHQSxDQUFDQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUN6QkEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsMkZBQTJGQSxHQUFHQSxTQUFTQSxDQUFDQSxDQUNwSEEsSUFBSUEsQ0FBQ0EsVUFBQ0EsSUFBSUE7WUFDUEEsUUFBUUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLENBQUNBLENBQUNBLENBQUFBO1FBQ05BLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBO0lBQzVCQSxDQUFDQTtJQUVMVixzQkFBQ0E7QUFBREEsQ0FwRkEsQUFvRkNBLElBQUE7QUFwRlksdUJBQWUsR0FBZixlQW9GWixDQUFBO0FBQUEsQ0FBQyIsImZpbGUiOiJtb2R1bGVzL21ldGFkYXRhL21ldGFkYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vLi4vdHlwaW5ncy90c2QuZC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vY29ubmVjdGlvbi9jb25uZWN0aW9uLnNlcnZpY2UudHNcIiAvPlxuXG5pbXBvcnQgUSA9IHJlcXVpcmUoXCJxXCIpO1xuaW1wb3J0IGNvbm5lY3Rpb24gPSByZXF1aXJlKCcuLi9jb25uZWN0aW9uL2Nvbm5lY3Rpb24uc2VydmljZScpXG5cbmV4cG9ydCBpbnRlcmZhY2UgSU1ldGFkYXRhU2VydmljZSB7XG4gICAgLy8gR0VUXG4gICAgZ2V0U3ViY2F0ZWdvcmllczBMaXN0KCk6IFEuSVByb21pc2U8e30+O1xuICAgIGdldFN1YmNhdGVnb3JpZXMxTGlzdCgpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRTY2hvb2xzTGlzdCgpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRTdHlsZXNMaXN0KCk6IFEuSVByb21pc2U8e30+O1xuICAgIGdldFNjaG9vbEJ5TWVtYmVySWQobWVtYmVySWQpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0TGlrZXMocHJvZHVjdElkKTogUS5JUHJvbWlzZTx7fT47XG4gICAgZ2V0UHJvZHVjdFVuaXF1ZVZpc2l0cyhwcm9kdWN0SWQpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0VG90YWxWaXNpdHMocHJvZHVjdElkKTogUS5JUHJvbWlzZTx7fT47XG5cbiAgICAvLyBQT1NUXG4gICAgY3JlYXRlUHJvZHVjdExpa2UocHJvZHVjdElkKTogUS5JUHJvbWlzZTx7fT47XG59XG5cblxuZXhwb3J0IGNsYXNzIE1ldGFkYXRhU2VydmljZSBpbXBsZW1lbnRzIElNZXRhZGF0YVNlcnZpY2Uge1xuICAgIHByaXZhdGUgZGIgPSBjb25uZWN0aW9uLnNlcnZpY2U7XG5cbiAgICBnZXRTdWJjYXRlZ29yaWVzMExpc3QoKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgX2xpc3RQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiU0VMRUNUIERJU1RJTkNUIG1ldGFfdmFsdWUgQVMgdmFsdWUgRlJPTSB3cDJfcG9zdG1ldGEgV0hFUkUgbWV0YV9rZXkgPSAnc29mYmFja2VuZF9fc29mX3dvcmtfbWV0YV9fY2F0ZWdvcnlfMCdcIilcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgX2xpc3RQcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0U3ViY2F0ZWdvcmllczFMaXN0KCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9saXN0UHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5kYi5xdWVyeV9kYihcIlNFTEVDVCBESVNUSU5DVCBtZXRhX3ZhbHVlIEFTIHZhbHVlIEZST00gd3AyX3Bvc3RtZXRhIFdIRVJFIG1ldGFfa2V5ID0gJ3NvZmJhY2tlbmRfX3NvZl93b3JrX21ldGFfX2NhdGVnb3J5XzEnXCIpXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIF9saXN0UHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIF9saXN0UHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGdldFNjaG9vbHNMaXN0KCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9saXN0UHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5kYi5xdWVyeV9kYihcIlNFTEVDVCBESVNUSU5DVCB2YWx1ZSBGUk9NIHdwMl9icF94cHJvZmlsZV9kYXRhIFdIRVJFIGZpZWxkX2lkPTRcIilcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgX2xpc3RQcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0U3R5bGVzTGlzdCgpOiBRLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHZhciBfbGlzdFByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJTRUxFQ1QgRElTVElOQ1QgbWV0YV92YWx1ZSBBUyB2YWx1ZSBGUk9NIHdwMl9wb3N0bWV0YSBXSEVSRSBtZXRhX2tleSA9ICdzb2ZiYWNrZW5kX19zb2Zfd29ya19tZXRhX19zdHlsZSdcIilcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgX2xpc3RQcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0U2Nob29sQnlNZW1iZXJJZChtZW1iZXJJZCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiU0VMRUNUIHZhbHVlIEZST00gd3AyX2JwX3hwcm9maWxlX2RhdGEgV0hFUkUgZmllbGRfaWQ9NCBBTkQgdXNlcl9pZD1cIiArIG1lbWJlcklkKVxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICBfcHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIF9wcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdExpa2VzKHByb2R1Y3RJZCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiU0VMRUNUIG1ldGFfdmFsdWUgQVMgdmFsdWUgRlJPTSB3cDJfcG9zdG1ldGEgV0hFUkUgbWV0YV9rZXk9J19pdGVtX2xpa2VzJyBBTkQgcG9zdF9pZD1cIiArIHByb2R1Y3RJZClcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgX3Byb21pc2UucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIHJldHVybiBfcHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGNyZWF0ZVByb2R1Y3RMaWtlKHByb2R1Y3RJZCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiVVBEQVRFIHdwMl9wb3N0bWV0YSBTRVQgbWV0YV92YWx1ZSA9IG1ldGFfdmFsdWUgKyAxIFdIRVJFIG1ldGFfa2V5PSdfaXRlbV9saWtlcycgQU5EIHBvc3RfaWQ9XCIgKyBwcm9kdWN0SWQpXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIF9wcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX3Byb21pc2UucHJvbWlzZTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0VW5pcXVlVmlzaXRzKHByb2R1Y3RJZCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiU0VMRUNUIENPVU5UKERJU1RJTkNUIG1ldGFfdmFsdWUpIEFTIHZhbHVlIEZST00gd3AyX3Bvc3RtZXRhIFdIRVJFIG1ldGFfa2V5ID0gJ3Zpc2l0JyBBTkQgcG9zdF9pZD1cIiArIHByb2R1Y3RJZClcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgX3Byb21pc2UucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIHJldHVybiBfcHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RUb3RhbFZpc2l0cyhwcm9kdWN0SWQpOiBRLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHZhciBfcHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5kYi5xdWVyeV9kYihcIlNFTEVDVCBDT1VOVChtZXRhX3ZhbHVlKSBBUyB2YWx1ZSBGUk9NIHdwMl9wb3N0bWV0YSBXSEVSRSBtZXRhX2tleSA9ICd2aXNpdCcgQU5EIHBvc3RfaWQ9XCIgKyBwcm9kdWN0SWQpXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIF9wcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX3Byb21pc2UucHJvbWlzZTtcbiAgICB9XG5cbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=