'use strict';
///<reference path="../../../typings/tsd.d.ts" />
///<reference path="./authors.service.ts" />
var service = require('./auth.service');
var Joi = require('joi');
var AuthService = new service.AuthService();
var _prefix = '/auth';
var auth = [
    {
        method: 'GET',
        path: _prefix + '/nonce/{controller}/{method}',
        handler: function (request, reply) {
            AuthService.getNonce(request.params.controller, request.params.method).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    controller: Joi.string(),
                    method: Joi.string()
                }
            },
            description: "Retrieve a Nonce",
            notes: [
                "Controller values: 'posts'",
                "Method values: 'create_post'/'update_post'/'delete_post'"
            ],
            tags: ['auth']
        }
    },
    {
        method: 'POST',
        path: _prefix + '/register',
        handler: function (request, reply) {
            AuthService.register(request.payload.username, request.payload.email, request.payload.password, request.payload.display_name, request.payload.years, request.payload.country, request.payload.school, request.payload.ob).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    username: Joi.string(),
                    email: Joi.string(),
                    password: Joi.string(),
                    display_name: Joi.string(),
                    years: Joi.number().integer(),
                    country: Joi.string(),
                    school: Joi.string(),
                    ob: Joi.string()
                }
            },
            description: 'Create a new User (need to create a new Nonce first and pass it as param)',
            tags: ['auth']
        }
    },
    {
        method: 'POST',
        path: _prefix + '/login',
        handler: function (request, reply) {
            AuthService.login(request.payload.username, request.payload.password).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    username: Joi.string(),
                    password: Joi.string()
                }
            },
            description: 'Login a User > Retrieve a Session Cookie',
            tags: ['auth']
        }
    },
    {
        method: 'POST',
        path: _prefix + '/facebook/login',
        handler: function (request, reply) {
            AuthService.fbLogin(request.payload.token).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    token: Joi.string()
                }
            },
            description: 'Login using Facebook',
            tags: ['auth']
        }
    },
    {
        method: 'POST',
        path: _prefix + '/is_authorized',
        handler: function (request, reply) {
            AuthService.isAuthorized(request.payload.cookie).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    cookie: Joi.string()
                }
            },
            description: 'Check if a Session Cookie is still valid',
            tags: ['auth']
        }
    },
    {
        method: 'GET',
        path: _prefix + '/get_user/{userId}',
        handler: function (request, reply) {
            AuthService.getUserInfo(request.params.userId).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    userId: Joi.string()
                }
            },
            description: 'Retrieve User info',
            tags: ['auth']
        }
    },
    ,
    {
        method: 'GET',
        path: _prefix + '/get_avatar/{userId}/{type}',
        handler: function (request, reply) {
            AuthService.getUserAvatar(request.params.userId, request.params.type).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    userId: Joi.string(),
                    type: Joi.string()
                }
            },
            description: "Retrieve User's Avatar",
            notes: [
                "Type values: 'full'/'thumb'"
            ],
            tags: ['auth']
        }
    },
    ,
    {
        method: 'POST',
        path: _prefix + '/reset_password',
        handler: function (request, reply) {
            AuthService.resetPassword(request.params.username).then(function (data) {
                reply(data);
            });
        },
        config: {
            validate: {
                query: {
                    username: Joi.string()
                }
            },
            description: "Reset User's Password and send an email with instructions",
            tags: ['auth']
        }
    },
];
module.exports = auth;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvYXV0aC9hdXRoLnJvdXRlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFFYixBQUlBLGlEQUppRDtBQUNqRCw0Q0FBNEM7QUFHNUMsSUFBTyxPQUFPLFdBQVcsZ0JBQWdCLENBQUMsQ0FBQztBQUMzQyxJQUFPLEdBQUcsV0FBVyxLQUFLLENBQUMsQ0FBQztBQUU1QixJQUFJLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUM1QyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUM7QUFDdEIsSUFBSSxJQUFJLEdBQUc7SUFDUDtRQUNJLE1BQU0sRUFBRSxLQUFLO1FBQ2IsSUFBSSxFQUFFLE9BQU8sR0FBRyw4QkFBOEI7UUFDOUMsT0FBTyxFQUFFLFVBQVMsT0FBTyxFQUFFLEtBQUs7WUFDNUIsV0FBVyxDQUFDLFFBQVEsQ0FDaEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQ3pCLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQ3pCLElBQUksQ0FBQyxVQUFDLElBQUk7Z0JBQ1AsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUNELE1BQU0sRUFBRTtZQUNKLFFBQVEsRUFBRTtnQkFDTixLQUFLLEVBQUU7b0JBQ0gsVUFBVSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUU7b0JBQ3hCLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFO2lCQUN2QjthQUNKO1lBQ0QsV0FBVyxFQUFFLGtCQUFrQjtZQUMvQixLQUFLLEVBQUU7Z0JBQ0gsNEJBQTRCO2dCQUM1QiwwREFBMEQ7YUFDN0Q7WUFDRCxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUM7U0FDakI7S0FDSjtJQUNEO1FBQ0ksTUFBTSxFQUFFLE1BQU07UUFDZCxJQUFJLEVBQUUsT0FBTyxHQUFHLFdBQVc7UUFDM0IsT0FBTyxFQUFFLFVBQVMsT0FBTyxFQUFFLEtB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QUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFDRCxNQUFNLEVBQUU7WUFDSixRQUFRLEVBQUU7Z0JBQ04sS0FBSyxFQUFFO29CQUNILE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFO29CQUNwQixJQUFJLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRTtpQkFDckI7YUFDSjtZQUNELFdBQVcsRUFBRSx3QkFBd0I7WUFDckMsS0FBSyxFQUFFO2dCQUNILDZCQUE2QjthQUNoQztZQUNELElBQUksRUFBRSxDQUFDLE1BQU0sQ0FBQztTQUNqQjtLQUNKO0lBQUMsQUFBQztJQUNIO1FBQ0ksTUFBTSxFQUFFLE1BQU07UUFDZCxJQUFJLEVBQUUsT0FBTyxHQUFHLGlCQUFpQjtRQUNqQyxPQUFPLEVBQUUsVUFBUyxPQUFPLEVBQUUsS0FBSztZQUM1QixXQUFXLENBQUMsYUFBYSxDQUNyQixPQUFPLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUMzQixJQUFJLENBQUMsVUFBQyxJQUFJO2dCQUNQLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoQixDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFDRCxNQUFNLEVBQUU7WUFDSixRQUFRLEVBQUU7Z0JBQ04sS0FBSyxFQUFFO29CQUNILFFBQVEsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFO2lCQUN6QjthQUNKO1lBQ0QsV0FBVyxFQUFFLDJEQUEyRDtZQUN4RSxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUM7U0FDakI7S0FDSjtDQUNKLENBQUE7QUFHRCxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyIsImZpbGUiOiJtb2R1bGVzL2F1dGgvYXV0aC5yb3V0ZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uLy4uL3R5cGluZ3MvdHNkLmQudHNcIiAvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi9hdXRob3JzLnNlcnZpY2UudHNcIiAvPlxuXG5cbmltcG9ydCBzZXJ2aWNlID0gcmVxdWlyZSgnLi9hdXRoLnNlcnZpY2UnKTtcbmltcG9ydCBKb2kgPSByZXF1aXJlKCdqb2knKTtcblxudmFyIEF1dGhTZXJ2aWNlID0gbmV3IHNlcnZpY2UuQXV0aFNlcnZpY2UoKTtcbnZhciBfcHJlZml4ID0gJy9hdXRoJztcbnZhciBhdXRoID0gW1xuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgcGF0aDogX3ByZWZpeCArICcvbm9uY2Uve2NvbnRyb2xsZXJ9L3ttZXRob2R9JyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24ocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmdldE5vbmNlKFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGFyYW1zLmNvbnRyb2xsZXIsXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXJhbXMubWV0aG9kKVxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICByZXBseShkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgdmFsaWRhdGU6IHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBKb2kuc3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogSm9pLnN0cmluZygpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlJldHJpZXZlIGEgTm9uY2VcIixcbiAgICAgICAgICAgIG5vdGVzOiBbXG4gICAgICAgICAgICAgICAgXCJDb250cm9sbGVyIHZhbHVlczogJ3Bvc3RzJ1wiLFxuICAgICAgICAgICAgICAgIFwiTWV0aG9kIHZhbHVlczogJ2NyZWF0ZV9wb3N0Jy8ndXBkYXRlX3Bvc3QnLydkZWxldGVfcG9zdCdcIlxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIHRhZ3M6IFsnYXV0aCddXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHBhdGg6IF9wcmVmaXggKyAnL3JlZ2lzdGVyJyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24ocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnJlZ2lzdGVyKFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5bG9hZC51c2VybmFtZSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBheWxvYWQuZW1haWwsXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXlsb2FkLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5bG9hZC5kaXNwbGF5X25hbWUsXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXlsb2FkLnllYXJzLFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5bG9hZC5jb3VudHJ5LFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5bG9hZC5zY2hvb2wsXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXlsb2FkLm9iKVxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICByZXBseShkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgdmFsaWRhdGU6IHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogSm9pLnN0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogSm9pLnN0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogSm9pLnN0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5X25hbWU6IEpvaS5zdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgeWVhcnM6IEpvaS5udW1iZXIoKS5pbnRlZ2VyKCksXG4gICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IEpvaS5zdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgc2Nob29sOiBKb2kuc3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIG9iOiBKb2kuc3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdDcmVhdGUgYSBuZXcgVXNlciAobmVlZCB0byBjcmVhdGUgYSBuZXcgTm9uY2UgZmlyc3QgYW5kIHBhc3MgaXQgYXMgcGFyYW0pJyxcbiAgICAgICAgICAgIHRhZ3M6IFsnYXV0aCddXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHBhdGg6IF9wcmVmaXggKyAnL2xvZ2luJyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24ocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmxvZ2luKFxuICAgICAgICAgICAgICAgIHJlcXVlc3QucGF5bG9hZC51c2VybmFtZSxcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBheWxvYWQucGFzc3dvcmQpXG4gICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVwbHkoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICB2YWxpZGF0ZToge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBKb2kuc3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBKb2kuc3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdMb2dpbiBhIFVzZXIgPiBSZXRyaWV2ZSBhIFNlc3Npb24gQ29va2llJyxcbiAgICAgICAgICAgIHRhZ3M6IFsnYXV0aCddXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHBhdGg6IF9wcmVmaXggKyAnL2ZhY2Vib29rL2xvZ2luJyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24ocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLmZiTG9naW4oXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXlsb2FkLnRva2VuKVxuICAgICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcGx5KGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgdmFsaWRhdGU6IHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbjogSm9pLnN0cmluZygpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTG9naW4gdXNpbmcgRmFjZWJvb2snLFxuICAgICAgICAgICAgdGFnczogWydhdXRoJ11cbiAgICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgcGF0aDogX3ByZWZpeCArICcvaXNfYXV0aG9yaXplZCcsXG4gICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uKHJlcXVlc3QsIHJlcGx5KSB7XG4gICAgICAgICAgICBBdXRoU2VydmljZS5pc0F1dGhvcml6ZWQoXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXlsb2FkLmNvb2tpZSlcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVwbHkoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIHZhbGlkYXRlOiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgY29va2llOiBKb2kuc3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdDaGVjayBpZiBhIFNlc3Npb24gQ29va2llIGlzIHN0aWxsIHZhbGlkJyxcbiAgICAgICAgICAgIHRhZ3M6IFsnYXV0aCddXG4gICAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgcGF0aDogX3ByZWZpeCArICcvZ2V0X3VzZXIve3VzZXJJZH0nLFxuICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihyZXF1ZXN0LCByZXBseSkge1xuICAgICAgICAgICAgQXV0aFNlcnZpY2UuZ2V0VXNlckluZm8oXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXJhbXMudXNlcklkKVxuICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICByZXBseShkYXRhKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgdmFsaWRhdGU6IHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IEpvaS5zdHJpbmcoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JldHJpZXZlIFVzZXIgaW5mbycsXG4gICAgICAgICAgICB0YWdzOiBbJ2F1dGgnXVxuICAgICAgICB9XG4gICAgfSwgLFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgcGF0aDogX3ByZWZpeCArICcvZ2V0X2F2YXRhci97dXNlcklkfS97dHlwZX0nLFxuICAgICAgICBoYW5kbGVyOiBmdW5jdGlvbihyZXF1ZXN0LCByZXBseSkge1xuICAgICAgICAgICAgQXV0aFNlcnZpY2UuZ2V0VXNlckF2YXRhcihcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBhcmFtcy51c2VySWQsXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXJhbXMudHlwZSlcbiAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVwbHkoZGF0YSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgIHZhbGlkYXRlOiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcklkOiBKb2kuc3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IEpvaS5zdHJpbmcoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJSZXRyaWV2ZSBVc2VyJ3MgQXZhdGFyXCIsXG4gICAgICAgICAgICBub3RlczogW1xuICAgICAgICAgICAgICAgIFwiVHlwZSB2YWx1ZXM6ICdmdWxsJy8ndGh1bWInXCJcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB0YWdzOiBbJ2F1dGgnXVxuICAgICAgICB9XG4gICAgfSwgLFxuICAgIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIHBhdGg6IF9wcmVmaXggKyAnL3Jlc2V0X3Bhc3N3b3JkJyxcbiAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24ocmVxdWVzdCwgcmVwbHkpIHtcbiAgICAgICAgICAgIEF1dGhTZXJ2aWNlLnJlc2V0UGFzc3dvcmQoXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wYXJhbXMudXNlcm5hbWUpXG4gICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlcGx5KGRhdGEpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICB2YWxpZGF0ZToge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBKb2kuc3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiUmVzZXQgVXNlcidzIFBhc3N3b3JkIGFuZCBzZW5kIGFuIGVtYWlsIHdpdGggaW5zdHJ1Y3Rpb25zXCIsXG4gICAgICAgICAgICB0YWdzOiBbJ2F1dGgnXVxuICAgICAgICB9XG4gICAgfSxcbl1cblxuXG5tb2R1bGUuZXhwb3J0cyA9IGF1dGg7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=