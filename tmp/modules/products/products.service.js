/// <reference path="../../../typings/tsd.d.ts" />
/// <reference path="../connection/connection.service.ts" />
var Q = require("q");
var connection = require('../connection/connection.service');
var auth = require("../auth/auth.service");
var metadata = require("../metadata/metadata.service");
var authServ = new auth.AuthService();
var metadataServ = new metadata.MetadataService();
var inArray = function (myArray, myValue) {
    var inArray = false;
    myArray.map(function (key) {
        if (key === myValue) {
            inArray = true;
        }
    });
    return inArray;
};
var ProductsService = (function () {
    function ProductsService() {
        this.db = connection.service;
    }
    ProductsService.prototype.getProductsNew = function (page) {
        var _listPromise = Q.defer();
        this.db.query('core/?json=get_recent_posts&count=4&page=' + page).then(function (results) {
            _listPromise.resolve(results);
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.getProductsList = function (page) {
        var _listPromise = Q.defer();
        var count = 15;
        this.db.query('core/?json=get_posts&count=' + count + '&page=' + page).then(function (results) {
            function shuffle(o) {
                for (var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x)
                    ;
                return o;
            }
            var shuffled = shuffle(results['posts']);
            results['posts'] = shuffled;
            var _postAuthorPopulate = [];
            var _postMetadataPopulate = [];
            results['posts'].forEach(function (result) {
                var authorPromise = Q.defer();
                var metadataPromise = Q.defer();
                _postAuthorPopulate.push(authorPromise.promise);
                _postMetadataPopulate.push(metadataPromise.promise);
                // populate author's avatar
                authServ.getUserAvatar(result.author.id, "thumb").then(function (data) {
                    result['author']['avatar'] = data['avatar'];
                    authorPromise.resolve(data);
                    // populate metadata
                    metadataServ.getProductMetadata(result.id).then(function (data2) {
                        result['metadata'] = data2;
                        metadataPromise.resolve(data2);
                    });
                });
            });
            Q.all(_postAuthorPopulate.concat(_postMetadataPopulate)).then(function (values) {
                _listPromise.resolve(results);
            });
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.getProductById = function (productId, userId) {
        var _this = this;
        var _productPromise = Q.defer();
        this.db.query('core/get_post/?id=' + productId).then(function (result) {
            var _promises = [];
            var authorPromise = Q.defer();
            var metadataPromise = Q.defer();
            var visitPromise = Q.defer();
            _promises.push(authorPromise.promise);
            _promises.push(metadataPromise.promise);
            _promises.push(visitPromise.promise);
            // populate author's avatar
            authServ.getUserAvatar(result['post']['author']['id'], "thumb").then(function (data) {
                result['post']['author']['avatar'] = data['avatar'];
                authorPromise.resolve(data);
                // populate metadata
                metadataServ.getProductMetadata(result['post']['id']).then(function (data2) {
                    result['post']['metadata'] = data2;
                    metadataPromise.resolve(data2);
                    // save visit if is logued in
                    if (userId != 'null') {
                        _this.db.query_db("INSERT INTO wp2_postmeta (meta_id, post_id, meta_key, meta_value) VALUES (NULL," + productId + ",'visit','" + userId + "')").then(function () {
                            visitPromise.resolve(undefined);
                        });
                    }
                    else {
                        visitPromise.resolve(undefined);
                    }
                    ;
                });
            });
            Q.all(_promises).then(function (values) {
                _productPromise.resolve(result);
            });
        });
        return _productPromise.promise;
    };
    ProductsService.prototype.getProductsByAuthor = function (authorId) {
        var _promise = Q.defer();
        this.db.query('core/get_author_posts/?count=4&id=' + authorId).then(function (results) {
            var _postAuthorPopulate = [];
            var headerPromise = Q.defer();
            // populate header avatar
            authServ.getUserAvatar(results['author']['id'], "thumb").then(function (data) {
                results['author']['avatar'] = data['avatar'];
                headerPromise.resolve(data);
                results['posts'].forEach(function (result) {
                    var authorPromise = Q.defer();
                    _postAuthorPopulate.push(authorPromise.promise);
                    // populate author's avatar
                    result['author']['avatar'] = data['avatar'];
                    authorPromise.resolve(data);
                });
            });
            Q.all(_postAuthorPopulate.concat(headerPromise.promise)).then(function (values) {
                _promise.resolve(results);
            });
        });
        return _promise.promise;
    };
    ProductsService.prototype.getProductsByCategory = function (categoryId, page) {
        var promise = Q.defer();
        this.db.query('core/get_category_posts/?count=4&id=' + categoryId + '&page=' + page).then(function (result) {
            // populate author's avatar
            authServ.getUserAvatar(result['author']['id'], "thumb").then(function (data) {
                result['author']['avatar'] = data['avatar'];
                promise.resolve(result);
            });
        });
        return promise.promise;
    };
    ProductsService.prototype.getProductsByTag = function (tagId, page) {
        var promise = Q.defer();
        this.db.query('core/get_tag_posts/?count=4&id=' + tagId + '&page=' + page).then(function (result) {
            // populate author's avatar
            authServ.getUserAvatar(result['author']['id'], "thumb").then(function (data) {
                result['author']['avatar'] = data['avatar'];
                promise.resolve(result);
            });
        });
        return promise.promise;
    };
    ProductsService.prototype.getProductsBySchool = function (schoolId, page) {
        var _this = this;
        var _listPromise = Q.defer();
        this.db.query('core/?json=get_posts&count=200').then(function (results) {
            var posts = results['posts'];
            _this.db.query_db("SELECT user_id FROM wp2_bp_xprofile_data WHERE value='" + schoolId + "' AND field_id=4").then(function (data) {
                var userIds = [];
                for (var i in data) {
                    userIds.push(data[i].user_id);
                }
                var schoolPosts = [];
                for (var j in posts) {
                    if (inArray(userIds, posts[j].author.id)) {
                        schoolPosts.push(posts[j]);
                    }
                    ;
                }
                ;
                results['posts'] = schoolPosts;
                results['school'] = schoolId;
                results['count'] = schoolPosts.length;
                results['count_total'] = schoolPosts.length;
                _listPromise.resolve(results);
            });
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.getProductsBySubcategory0 = function (subcategory0Id, page) {
        var _listPromise = Q.defer();
        this.db.query('core/?json=get_posts&count=200').then(function (results) {
            var posts = results['posts'];
            var subcategory0Posts = [];
            for (var i in posts) {
                if (posts[i]['custom_fields']['sofbackend__sof_work_meta__category_0'] == subcategory0Id) {
                    subcategory0Posts.push(posts[i]);
                }
                ;
            }
            ;
            results['posts'] = subcategory0Posts;
            results['subcategory0'] = subcategory0Id;
            results['count'] = subcategory0Posts.length;
            results['count_total'] = subcategory0Posts.length;
            _listPromise.resolve(results);
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.getProductsBySubcategory1 = function (subcategory1Id, page) {
        var _listPromise = Q.defer();
        this.db.query('core/?json=get_posts&count=200').then(function (results) {
            var posts = results['posts'];
            var subcategory1Posts = [];
            for (var i in posts) {
                if (posts[i]['custom_fields']['sofbackend__sof_work_meta__category_0'] == subcategory1Id) {
                    subcategory1Posts.push(posts[i]);
                }
                ;
            }
            ;
            results['posts'] = subcategory1Posts;
            results['subcategory0'] = subcategory1Id;
            results['count'] = subcategory1Posts.length;
            results['count_total'] = subcategory1Posts.length;
            _listPromise.resolve(results);
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.getProductsByStyle = function (styleId, page) {
        var _listPromise = Q.defer();
        this.db.query('core/?json=get_posts&count=200').then(function (results) {
            var posts = results['posts'];
            var stylePosts = [];
            for (var i in posts) {
                if (posts[i]['custom_fields']['sofbackend__sof_work_meta__category_0'] == styleId) {
                    stylePosts.push(posts[i]);
                }
                ;
            }
            ;
            results['posts'] = stylePosts;
            results['subcategory0'] = styleId;
            results['count'] = stylePosts.length;
            results['count_total'] = stylePosts.length;
            _listPromise.resolve(results);
        });
        return _listPromise.promise;
    };
    ProductsService.prototype.createProduct = function (nonce, author, title, content, status, school, subcategory0, subcategory1, styles) {
        return this.db.query('posts/create_post/?nonce=' + nonce + '&author=' + author + '&title=' + title + '&content=' + content + '&status=' + status).then(function (post) {
            console.log(post);
            // FALTA GUARDAR SCHOOL, SUBCATEGORY, STYLES
            return post;
        });
    };
    ProductsService.prototype.updateProduct = function (nonce, productId, author, title, content, status, categories, tags) {
        return this.db.query('posts/update_post/?nonce=' + nonce + '&id=' + productId + '&author=' + author + '&title=' + title + '&content=' + content + '&status=' + status + '&categories=' + categories + '&tags=' + tags);
    };
    ProductsService.prototype.deleteProduct = function (nonce, productId) {
        return this.db.query('posts/delete_post/?nonce=' + nonce + '&id=' + productId);
    };
    ProductsService.prototype.createComment = function (productId, cookie, content) {
        return this.db.query('user/post_comment/?post_id=' + productId + '&cookie=' + cookie + '&comment_status=1' + '&content=' + content);
    };
    ProductsService.prototype.getProductsBySearch = function (search, page) {
        var _searchPromise = Q.defer();
        this.db.query('core/get_search_results/?count=4&search=' + search + '&page=' + page).then(function (results) {
            var _postAuthorPopulate = [];
            results['posts'].forEach(function (result) {
                var authorPromise = Q.defer();
                _postAuthorPopulate.push(authorPromise.promise);
                authServ.getUserAvatar(result.author.id, "thumb").then(function (data) {
                    result['author']['avatar'] = data['avatar'];
                    authorPromise.resolve(data);
                    metadataServ.getProductMetadata(result.id).then(function (data2) {
                        result['metadata'] = data2;
                    });
                });
            });
            Q.all(_postAuthorPopulate).then(function () {
                _searchPromise.resolve(results);
            });
        });
        return _searchPromise.promise;
    };
    return ProductsService;
})();
exports.ProductsService = ProductsService;
;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZXMvcHJvZHVjdHMvcHJvZHVjdHMuc2VydmljZS50cyJdLCJuYW1lcyI6WyJQcm9kdWN0c1NlcnZpY2UiLCJQcm9kdWN0c1NlcnZpY2UuY29uc3RydWN0b3IiLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNOZXciLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNMaXN0IiwiUHJvZHVjdHNTZXJ2aWNlLmdldFByb2R1Y3RzTGlzdC5zaHVmZmxlIiwiUHJvZHVjdHNTZXJ2aWNlLmdldFByb2R1Y3RCeUlkIiwiUHJvZHVjdHNTZXJ2aWNlLmdldFByb2R1Y3RzQnlBdXRob3IiLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNCeUNhdGVnb3J5IiwiUHJvZHVjdHNTZXJ2aWNlLmdldFByb2R1Y3RzQnlUYWciLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNCeVNjaG9vbCIsIlByb2R1Y3RzU2VydmljZS5nZXRQcm9kdWN0c0J5U3ViY2F0ZWdvcnkwIiwiUHJvZHVjdHNTZXJ2aWNlLmdldFByb2R1Y3RzQnlTdWJjYXRlZ29yeTEiLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNCeVN0eWxlIiwiUHJvZHVjdHNTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QiLCJQcm9kdWN0c1NlcnZpY2UudXBkYXRlUHJvZHVjdCIsIlByb2R1Y3RzU2VydmljZS5kZWxldGVQcm9kdWN0IiwiUHJvZHVjdHNTZXJ2aWNlLmNyZWF0ZUNvbW1lbnQiLCJQcm9kdWN0c1NlcnZpY2UuZ2V0UHJvZHVjdHNCeVNlYXJjaCJdLCJtYXBwaW5ncyI6IkFBQUEsa0RBQWtEO0FBQ2xELDREQUE0RDtBQUU1RCxJQUFPLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztBQUN4QixJQUFPLFVBQVUsV0FBVyxrQ0FBa0MsQ0FBQyxDQUFBO0FBQy9ELElBQU8sSUFBSSxXQUFXLHNCQUFzQixDQUFDLENBQUE7QUFDN0MsSUFBTyxRQUFRLFdBQVcsOEJBQThCLENBQUMsQ0FBQztBQUUxRCxJ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QUFDQSxPQUFPQSxDQUFDQTtJQUNsQ0EsQ0FBQ0E7SUFFTGpCLHNCQUFDQTtBQUFEQSxDQS9VQSxBQStVQ0EsSUFBQTtBQS9VWSx1QkFBZSxHQUFmLGVBK1VaLENBQUE7QUFBQSxDQUFDIiwiZmlsZSI6Im1vZHVsZXMvcHJvZHVjdHMvcHJvZHVjdHMuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi8uLi90eXBpbmdzL3RzZC5kLnRzXCIgLz5cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi9jb25uZWN0aW9uL2Nvbm5lY3Rpb24uc2VydmljZS50c1wiIC8+XG5cbmltcG9ydCBRID0gcmVxdWlyZShcInFcIik7XG5pbXBvcnQgY29ubmVjdGlvbiA9IHJlcXVpcmUoJy4uL2Nvbm5lY3Rpb24vY29ubmVjdGlvbi5zZXJ2aWNlJylcbmltcG9ydCBhdXRoID0gcmVxdWlyZShcIi4uL2F1dGgvYXV0aC5zZXJ2aWNlXCIpXG5pbXBvcnQgbWV0YWRhdGEgPSByZXF1aXJlKFwiLi4vbWV0YWRhdGEvbWV0YWRhdGEuc2VydmljZVwiKTtcblxudmFyIGF1dGhTZXJ2ID0gbmV3IGF1dGguQXV0aFNlcnZpY2UoKTtcbnZhciBtZXRhZGF0YVNlcnYgPSBuZXcgbWV0YWRhdGEuTWV0YWRhdGFTZXJ2aWNlKCk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVByb2R1Y3RzU2VydmljZSB7XG4gICAgLy8gR0VUXG4gICAgZ2V0UHJvZHVjdHNOZXcocGFnZSk6IFEuSVByb21pc2U8e30+O1xuICAgIGdldFByb2R1Y3RzTGlzdChwYWdlKTogUS5JUHJvbWlzZTx7fT47XG4gICAgZ2V0UHJvZHVjdEJ5SWQocHJvZHVjdElkLCB1c2VySWQpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0c0J5QXV0aG9yKGF1dGhvcklkLCBwYWdlKTogUS5JUHJvbWlzZTx7fT47XG4gICAgZ2V0UHJvZHVjdHNCeUNhdGVnb3J5KGNhdGVnb3J5SWQsIHBhZ2UpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0c0J5VGFnKHRhZ0lkLCBwYWdlKTogUS5JUHJvbWlzZTx7fT47XG4gICAgZ2V0UHJvZHVjdHNCeVNjaG9vbChzY2hvb2xJZCwgcGFnZSk6IFEuSVByb21pc2U8e30+O1xuICAgIGdldFByb2R1Y3RzQnlTdWJjYXRlZ29yeTAoc3ViY2F0ZWdvcnkwSWQsIHBhZ2UpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0c0J5U3ViY2F0ZWdvcnkxKHN1YmNhdGVnb3J5MUlkLCBwYWdlKTogUS5JUHJvbWlzZTx7fT47XG4gICAgZ2V0UHJvZHVjdHNCeVN0eWxlKHN0eWxlSWQsIHBhZ2UpOiBRLklQcm9taXNlPHt9PjtcbiAgICBnZXRQcm9kdWN0c0J5U2VhcmNoKHNlYXJjaCwgcGFnZSk6IFEuSVByb21pc2U8e30+O1xuICAgIC8vIFBPU1RcbiAgICBjcmVhdGVQcm9kdWN0KG5vbmNlLCBhdXRob3IsIHRpdGxlLCBjb250ZW50LCBzdGF0dXMsIHNjaG9vbCwgc3ViY2F0ZWdvcnkwLCBzdWJjYXRlZ29yeTEsIHN0eWxlcyk6IFEuSVByb21pc2U8e30+O1xuICAgIGNyZWF0ZUNvbW1lbnQocHJvZHVjdElkLCBjb29raWUsIGNvbnRlbnQpOiBRLklQcm9taXNlPHt9PjtcbiAgICAvLyBQVVRcbiAgICB1cGRhdGVQcm9kdWN0KG5vbmNlLCBwcm9kdWN0SWQsIGF1dGhvciwgdGl0bGUsIGNvbnRlbnQsIHN0YXR1cywgY2F0ZWdvcmllcywgdGFncyk6IFEuSVByb21pc2U8e30+O1xuICAgIC8vIERFTEVURVxuICAgIGRlbGV0ZVByb2R1Y3Qobm9uY2UsIHByb2R1Y3RJZCk6IFEuSVByb21pc2U8e30+O1xufVxuXG52YXIgaW5BcnJheSA9IGZ1bmN0aW9uKG15QXJyYXksIG15VmFsdWUpIHtcbiAgICB2YXIgaW5BcnJheSA9IGZhbHNlO1xuICAgIG15QXJyYXkubWFwKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoa2V5ID09PSBteVZhbHVlKSB7XG4gICAgICAgICAgICBpbkFycmF5ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBpbkFycmF5O1xufTtcblxuZXhwb3J0IGNsYXNzIFByb2R1Y3RzU2VydmljZSBpbXBsZW1lbnRzIElQcm9kdWN0c1NlcnZpY2Uge1xuICAgIHByaXZhdGUgZGIgPSBjb25uZWN0aW9uLnNlcnZpY2U7XG5cbiAgICBnZXRQcm9kdWN0c05ldyhwYWdlKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgX2xpc3RQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5KCdjb3JlLz9qc29uPWdldF9yZWNlbnRfcG9zdHMmY291bnQ9NCZwYWdlPScgKyBwYWdlKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgICAgICAgICAgICBfbGlzdFByb21pc2UucmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIF9saXN0UHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RzTGlzdChwYWdlKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgX2xpc3RQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB2YXIgY291bnQgPSAxNTtcbiAgICAgICAgdGhpcy5kYi5xdWVyeSgnY29yZS8/anNvbj1nZXRfcG9zdHMmY291bnQ9JyArIGNvdW50ICsgJyZwYWdlPScgKyBwYWdlKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNodWZmbGUobykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqLCB4LCBpID0gby5sZW5ndGg7IGk7IGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpKSwgeCA9IG9bLS1pXSwgb1tpXSA9IG9bal0sIG9bal0gPSB4KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzaHVmZmxlZCA9IHNodWZmbGUocmVzdWx0c1sncG9zdHMnXSk7XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzWydwb3N0cyddID0gc2h1ZmZsZWQ7XG4gICAgICAgICAgICAgICAgdmFyIF9wb3N0QXV0aG9yUG9wdWxhdGUgPSBbXTtcbiAgICAgICAgICAgICAgICB2YXIgX3Bvc3RNZXRhZGF0YVBvcHVsYXRlID0gW107XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzWydwb3N0cyddLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXV0aG9yUHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1ldGFkYXRhUHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgX3Bvc3RBdXRob3JQb3B1bGF0ZS5wdXNoKGF1dGhvclByb21pc2UucHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgIF9wb3N0TWV0YWRhdGFQb3B1bGF0ZS5wdXNoKG1ldGFkYXRhUHJvbWlzZS5wcm9taXNlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSBhdXRob3IncyBhdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnYuZ2V0VXNlckF2YXRhcihyZXN1bHQuYXV0aG9yLmlkLCBcInRodW1iXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnYXV0aG9yJ11bJ2F2YXRhciddID0gZGF0YVsnYXZhdGFyJ107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yUHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcG9wdWxhdGUgbWV0YWRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YVNlcnYuZ2V0UHJvZHVjdE1ldGFkYXRhKHJlc3VsdC5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbJ21ldGFkYXRhJ10gPSBkYXRhMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhUHJvbWlzZS5yZXNvbHZlKGRhdGEyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBRLmFsbChfcG9zdEF1dGhvclBvcHVsYXRlLmNvbmNhdChfcG9zdE1ldGFkYXRhUG9wdWxhdGUpKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigodmFsdWVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfbGlzdFByb21pc2UucmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdEJ5SWQocHJvZHVjdElkLCB1c2VySWQpOiBRLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHZhciBfcHJvZHVjdFByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnkoJ2NvcmUvZ2V0X3Bvc3QvP2lkPScgKyBwcm9kdWN0SWQpXG4gICAgICAgICAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIF9wcm9taXNlcyA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBhdXRob3JQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBtZXRhZGF0YVByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHZpc2l0UHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBfcHJvbWlzZXMucHVzaChhdXRob3JQcm9taXNlLnByb21pc2UpO1xuICAgICAgICAgICAgICAgIF9wcm9taXNlcy5wdXNoKG1ldGFkYXRhUHJvbWlzZS5wcm9taXNlKTtcbiAgICAgICAgICAgICAgICBfcHJvbWlzZXMucHVzaCh2aXNpdFByb21pc2UucHJvbWlzZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSBhdXRob3IncyBhdmF0YXJcbiAgICAgICAgICAgICAgICBhdXRoU2Vydi5nZXRVc2VyQXZhdGFyKHJlc3VsdFsncG9zdCddWydhdXRob3InXVsnaWQnXSwgXCJ0aHVtYlwiKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Wydwb3N0J11bJ2F1dGhvciddWydhdmF0YXInXSA9IGRhdGFbJ2F2YXRhciddO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yUHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSBtZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFTZXJ2LmdldFByb2R1Y3RNZXRhZGF0YShyZXN1bHRbJ3Bvc3QnXVsnaWQnXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YTIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Wydwb3N0J11bJ21ldGFkYXRhJ10gPSBkYXRhMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFQcm9taXNlLnJlc29sdmUoZGF0YTIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNhdmUgdmlzaXQgaWYgaXMgbG9ndWVkIGluXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VySWQgIT0gJ251bGwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRiLnF1ZXJ5X2RiKFwiSU5TRVJUIElOVE8gd3AyX3Bvc3RtZXRhIChtZXRhX2lkLCBwb3N0X2lkLCBtZXRhX2tleSwgbWV0YV92YWx1ZSkgVkFMVUVTIChOVUxMLFwiICsgcHJvZHVjdElkICsgXCIsJ3Zpc2l0JywnXCIgKyB1c2VySWQgKyBcIicpXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpdFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIFEuYWxsKF9wcm9taXNlcylcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCh2YWx1ZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcHJvZHVjdFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gX3Byb2R1Y3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdHNCeUF1dGhvcihhdXRob3JJZCk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9wcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5KCdjb3JlL2dldF9hdXRob3JfcG9zdHMvP2NvdW50PTQmaWQ9JyArIGF1dGhvcklkKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX3Bvc3RBdXRob3JQb3B1bGF0ZSA9IFtdO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkZXJQcm9taXNlID0gUS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgLy8gcG9wdWxhdGUgaGVhZGVyIGF2YXRhclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2LmdldFVzZXJBdmF0YXIocmVzdWx0c1snYXV0aG9yJ11bJ2lkJ10sIFwidGh1bWJcIilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbJ2F1dGhvciddWydhdmF0YXInXSA9IGRhdGFbJ2F2YXRhciddO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyUHJvbWlzZS5yZXNvbHZlKGRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzWydwb3N0cyddLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdXRob3JQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wb3N0QXV0aG9yUG9wdWxhdGUucHVzaChhdXRob3JQcm9taXNlLnByb21pc2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcG9wdWxhdGUgYXV0aG9yJ3MgYXZhdGFyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0WydhdXRob3InXVsnYXZhdGFyJ10gPSBkYXRhWydhdmF0YXInXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRob3JQcm9taXNlLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBRLmFsbChfcG9zdEF1dGhvclBvcHVsYXRlLmNvbmNhdChoZWFkZXJQcm9taXNlLnByb21pc2UpKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9wcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX3Byb21pc2UucHJvbWlzZTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0c0J5Q2F0ZWdvcnkoY2F0ZWdvcnlJZCwgcGFnZSk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIHByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnkoJ2NvcmUvZ2V0X2NhdGVnb3J5X3Bvc3RzLz9jb3VudD00JmlkPScgKyBjYXRlZ29yeUlkICtcbiAgICAgICAgICAgICAgICAgICAgICAgICcmcGFnZT0nICsgcGFnZSlcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBwb3B1bGF0ZSBhdXRob3IncyBhdmF0YXJcbiAgICAgICAgICAgICAgICBhdXRoU2Vydi5nZXRVc2VyQXZhdGFyKHJlc3VsdFsnYXV0aG9yJ11bJ2lkJ10sIFwidGh1bWJcIilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnYXV0aG9yJ11bJ2F2YXRhciddID0gZGF0YVsnYXZhdGFyJ107XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gcHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RzQnlUYWcodGFnSWQsIHBhZ2UpOiBRLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHZhciBwcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5KCdjb3JlL2dldF90YWdfcG9zdHMvP2NvdW50PTQmaWQ9JyArIHRhZ0lkICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyZwYWdlPScgKyBwYWdlKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIHBvcHVsYXRlIGF1dGhvcidzIGF2YXRhclxuICAgICAgICAgICAgICAgIGF1dGhTZXJ2LmdldFVzZXJBdmF0YXIocmVzdWx0WydhdXRob3InXVsnaWQnXSwgXCJ0aHVtYlwiKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0WydhdXRob3InXVsnYXZhdGFyJ10gPSBkYXRhWydhdmF0YXInXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIHJldHVybiBwcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdHNCeVNjaG9vbChzY2hvb2xJZCwgcGFnZSk6IFEuSVByb21pc2U8e30+IHtcbiAgICAgICAgdmFyIF9saXN0UHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgdGhpcy5kYi5xdWVyeSgnY29yZS8/anNvbj1nZXRfcG9zdHMmY291bnQ9MjAwJylcbiAgICAgICAgICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICAgICAgICAgICAgdmFyIHBvc3RzID0gcmVzdWx0c1sncG9zdHMnXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZGIucXVlcnlfZGIoXCJTRUxFQ1QgdXNlcl9pZCBGUk9NIHdwMl9icF94cHJvZmlsZV9kYXRhIFdIRVJFIHZhbHVlPSdcIiArIHNjaG9vbElkICsgXCInIEFORCBmaWVsZF9pZD00XCIpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklkcyA9IFtdXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySWRzLnB1c2goZGF0YVtpXS51c2VyX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjaG9vbFBvc3RzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIHBvc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluQXJyYXkodXNlcklkcywgcG9zdHNbal0uYXV0aG9yLmlkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hvb2xQb3N0cy5wdXNoKHBvc3RzW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbJ3Bvc3RzJ10gPSBzY2hvb2xQb3N0cztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbJ3NjaG9vbCddID0gc2Nob29sSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzWydjb3VudCddID0gc2Nob29sUG9zdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1snY291bnRfdG90YWwnXSA9IHNjaG9vbFBvc3RzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2xpc3RQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgZ2V0UHJvZHVjdHNCeVN1YmNhdGVnb3J5MChzdWJjYXRlZ29yeTBJZCwgcGFnZSk6IFEuSVByb21pc2U8e30+IMKge1xuICAgICAgICB2YXIgX2xpc3RQcm9taXNlID0gUS5kZWZlcigpO1xuICAgICAgICB0aGlzLmRiLnF1ZXJ5KCdjb3JlLz9qc29uPWdldF9wb3N0cyZjb3VudD0yMDAnKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgcG9zdHMgPSByZXN1bHRzWydwb3N0cyddO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1YmNhdGVnb3J5MFBvc3RzID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBwb3N0cykge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3N0c1tpXVsnY3VzdG9tX2ZpZWxkcyddWydzb2ZiYWNrZW5kX19zb2Zfd29ya19tZXRhX19jYXRlZ29yeV8wJ10gPT0gc3ViY2F0ZWdvcnkwSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmNhdGVnb3J5MFBvc3RzLnB1c2gocG9zdHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXN1bHRzWydwb3N0cyddID0gc3ViY2F0ZWdvcnkwUG9zdHM7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1snc3ViY2F0ZWdvcnkwJ10gPSBzdWJjYXRlZ29yeTBJZDtcbiAgICAgICAgICAgICAgICByZXN1bHRzWydjb3VudCddID0gc3ViY2F0ZWdvcnkwUG9zdHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbJ2NvdW50X3RvdGFsJ10gPSBzdWJjYXRlZ29yeTBQb3N0cy5sZW5ndGg7XG5cbiAgICAgICAgICAgICAgICBfbGlzdFByb21pc2UucmVzb2x2ZShyZXN1bHRzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIHJldHVybiBfbGlzdFByb21pc2UucHJvbWlzZTtcbiAgICB9XG5cbiAgICBnZXRQcm9kdWN0c0J5U3ViY2F0ZWdvcnkxKHN1YmNhdGVnb3J5MUlkLCBwYWdlKTogUS5JUHJvbWlzZTx7fT4gwqB7XG4gICAgICAgIHZhciBfbGlzdFByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnkoJ2NvcmUvP2pzb249Z2V0X3Bvc3RzJmNvdW50PTIwMCcpXG4gICAgICAgICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBwb3N0cyA9IHJlc3VsdHNbJ3Bvc3RzJ107XG5cbiAgICAgICAgICAgICAgICB2YXIgc3ViY2F0ZWdvcnkxUG9zdHMgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHBvc3RzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvc3RzW2ldWydjdXN0b21fZmllbGRzJ11bJ3NvZmJhY2tlbmRfX3NvZl93b3JrX21ldGFfX2NhdGVnb3J5XzAnXSA9PSBzdWJjYXRlZ29yeTFJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3ViY2F0ZWdvcnkxUG9zdHMucHVzaChwb3N0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdHNbJ3Bvc3RzJ10gPSBzdWJjYXRlZ29yeTFQb3N0cztcbiAgICAgICAgICAgICAgICByZXN1bHRzWydzdWJjYXRlZ29yeTAnXSA9IHN1YmNhdGVnb3J5MUlkO1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbJ2NvdW50J10gPSBzdWJjYXRlZ29yeTFQb3N0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1snY291bnRfdG90YWwnXSA9IHN1YmNhdGVnb3J5MVBvc3RzLmxlbmd0aDtcblxuICAgICAgICAgICAgICAgIF9saXN0UHJvbWlzZS5yZXNvbHZlKHJlc3VsdHMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIF9saXN0UHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxuICAgIGdldFByb2R1Y3RzQnlTdHlsZShzdHlsZUlkLCBwYWdlKTogUS5JUHJvbWlzZTx7fT4gwqB7XG4gICAgICAgIHZhciBfbGlzdFByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnkoJ2NvcmUvP2pzb249Z2V0X3Bvc3RzJmNvdW50PTIwMCcpXG4gICAgICAgICAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBwb3N0cyA9IHJlc3VsdHNbJ3Bvc3RzJ107XG5cbiAgICAgICAgICAgICAgICB2YXIgc3R5bGVQb3N0cyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gcG9zdHMpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocG9zdHNbaV1bJ2N1c3RvbV9maWVsZHMnXVsnc29mYmFja2VuZF9fc29mX3dvcmtfbWV0YV9fY2F0ZWdvcnlfMCddID09IHN0eWxlSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlUG9zdHMucHVzaChwb3N0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdHNbJ3Bvc3RzJ10gPSBzdHlsZVBvc3RzO1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbJ3N1YmNhdGVnb3J5MCddID0gc3R5bGVJZDtcbiAgICAgICAgICAgICAgICByZXN1bHRzWydjb3VudCddID0gc3R5bGVQb3N0cy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgcmVzdWx0c1snY291bnRfdG90YWwnXSA9IHN0eWxlUG9zdHMubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgX2xpc3RQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICByZXR1cm4gX2xpc3RQcm9taXNlLnByb21pc2U7XG4gICAgfVxuXG4gICAgY3JlYXRlUHJvZHVjdChub25jZSwgYXV0aG9yLCB0aXRsZSwgY29udGVudCwgc3RhdHVzLCBzY2hvb2wsIHN1YmNhdGVnb3J5MCwgc3ViY2F0ZWdvcnkxLCBzdHlsZXMpOiBRLklQcm9taXNlPHt9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLnF1ZXJ5KCdwb3N0cy9jcmVhdGVfcG9zdC8/bm9uY2U9JyArIG5vbmNlICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyZhdXRob3I9JyArIGF1dGhvciArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmdGl0bGU9JyArIHRpdGxlICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyZjb250ZW50PScgKyBjb250ZW50ICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyZzdGF0dXM9JyArIHN0YXR1cylcbiAgICAgICAgICAgIC50aGVuKChwb3N0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocG9zdCk7XG5cbiAgICAgICAgICAgICAgICAvLyBGQUxUQSBHVUFSREFSIFNDSE9PTCwgU1VCQ0FURUdPUlksIFNUWUxFU1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc3Q7XG4gICAgICAgICAgICB9KVxuICAgIH1cblxuICAgIHVwZGF0ZVByb2R1Y3Qobm9uY2UsIHByb2R1Y3RJZCwgYXV0aG9yLCB0aXRsZSwgY29udGVudCwgc3RhdHVzLCBjYXRlZ29yaWVzLCB0YWdzKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5xdWVyeSgncG9zdHMvdXBkYXRlX3Bvc3QvP25vbmNlPScgKyBub25jZSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmaWQ9JyArIHByb2R1Y3RJZCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmYXV0aG9yPScgKyBhdXRob3IgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJnRpdGxlPScgKyB0aXRsZSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmY29udGVudD0nICsgY29udGVudCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmc3RhdHVzPScgKyBzdGF0dXMgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJmNhdGVnb3JpZXM9JyArIGNhdGVnb3JpZXMgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJnRhZ3M9JyArIHRhZ3MpXG4gICAgfVxuXG4gICAgZGVsZXRlUHJvZHVjdChub25jZSwgcHJvZHVjdElkKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5xdWVyeSgncG9zdHMvZGVsZXRlX3Bvc3QvP25vbmNlPScgKyBub25jZSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmaWQ9JyArIHByb2R1Y3RJZClcbiAgICB9XG5cbiAgICBjcmVhdGVDb21tZW50KHByb2R1Y3RJZCwgY29va2llLCBjb250ZW50KTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kYi5xdWVyeSgndXNlci9wb3N0X2NvbW1lbnQvP3Bvc3RfaWQ9JyArIHByb2R1Y3RJZCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmY29va2llPScgKyBjb29raWUgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJmNvbW1lbnRfc3RhdHVzPTEnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyZjb250ZW50PScgKyBjb250ZW50KVxuICAgIH1cblxuICAgIGdldFByb2R1Y3RzQnlTZWFyY2goc2VhcmNoLCBwYWdlKTogUS5JUHJvbWlzZTx7fT4ge1xuICAgICAgICB2YXIgX3NlYXJjaFByb21pc2UgPSBRLmRlZmVyKCk7XG4gICAgICAgIHRoaXMuZGIucXVlcnkoJ2NvcmUvZ2V0X3NlYXJjaF9yZXN1bHRzLz9jb3VudD00JnNlYXJjaD0nICsgc2VhcmNoICtcbiAgICAgICAgICAgICcmcGFnZT0nICsgcGFnZSkudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgICAgICAgdmFyIF9wb3N0QXV0aG9yUG9wdWxhdGUgPSBbXTtcblxuICAgICAgICAgICAgcmVzdWx0c1sncG9zdHMnXS5mb3JFYWNoKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgYXV0aG9yUHJvbWlzZSA9IFEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBfcG9zdEF1dGhvclBvcHVsYXRlLnB1c2goYXV0aG9yUHJvbWlzZS5wcm9taXNlKTtcbiAgICAgICAgICAgICAgICBhdXRoU2Vydi5nZXRVc2VyQXZhdGFyKHJlc3VsdC5hdXRob3IuaWQsIFwidGh1bWJcIilcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnYXV0aG9yJ11bJ2F2YXRhciddPSBkYXRhWydhdmF0YXInXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvclByb21pc2UucmVzb2x2ZShkYXRhKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFTZXJ2LmdldFByb2R1Y3RNZXRhZGF0YShyZXN1bHQuaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFsnbWV0YWRhdGEnXSA9IGRhdGEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgUS5hbGwoX3Bvc3RBdXRob3JQb3B1bGF0ZSlcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIF9zZWFyY2hQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBfc2VhcmNoUHJvbWlzZS5wcm9taXNlO1xuICAgIH1cblxufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==